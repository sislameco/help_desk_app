@if (isValid()) {
  <form
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    class="d-grid app-login-form gap-4"
    #formElem="ngForm"
  >
    <div class="text-start mb-3">
      <h2 class="text-start mb-1">Set New Password</h2>
      <p>Make sure it’s strong and something you’ll remember.</p>
    </div>

    <div
      class="form-group"
      [class.error]="
        form.controls.newPassword.errors?.['required'] &&
        (form.controls.newPassword.touched || formElem.submitted)
      "
    >
      <label class="form-label" for="password"> Password </label>
      <div class="append-input">
        <input
          id="password"
          class="form-control mt-0 pe-4"
          [formControl]="form.controls.newPassword"
          placeholder="Enter your password"
          required
          autocomplete="new-password"
          appShowHidePassword
          #newPwdToggler="appShowHidePassword"
        />
        <div class="left-icon">
          <svg width="15" viewBox="0 0 15 18" fill="currentColor">
            <use href="assets/sprite.svg#svg-lock"></use>
          </svg>
        </div>
        <div
          class="right-icon cursor-pointer"
          role="button"
          tabindex="0"
          (click)="newPwdToggler.toggle()"
          (keydown.enter)="newPwdToggler.toggle()"
          (keydown.space)="newPwdToggler.toggle()"
          aria-label="Show or hide password"
        >
          <svg width="15" viewBox="0 0 12 7" fill="currentColor">
            <use href="assets/sprite.svg#svg-deactivate-s-icon"></use>
          </svg>
        </div>
      </div>
      <p class="text-danger" *ngxControlError="form.controls.newPassword; track: 'required'">
        Password is required.
      </p>
      <div
        class="text-end text-gray mt-1 cursor-pointer"
        role="button"
        tabindex="0"
        (click)="generatePassword()"
        (keydown.enter)="generatePassword()"
        (keydown.space)="generatePassword()"
        aria-label="Generate a strong password"
      >
        Generate Password
      </div>
    </div>
    <div
      class="form-group"
      [class.error]="
        form.controls.confirmNewPassword.invalid &&
        (form.controls.confirmNewPassword.touched || formElem.submitted)
      "
    >
      <label class="form-label" for="confirmPassword">Confirm Password </label>
      <div class="append-input">
        <input
          id="confirmPassword"
          class="form-control mt-0 pe-4"
          [formControl]="form.controls.confirmNewPassword"
          placeholder="Enter your password"
          required
          appShowHidePassword
          #confirmPwdToggler="appShowHidePassword"
        />
        <div class="left-icon">
          <svg width="15" viewBox="0 0 15 18" fill="currentColor">
            <use href="assets/sprite.svg#svg-lock"></use>
          </svg>
        </div>
        <div
          class="right-icon cursor-pointer"
          role="button"
          tabindex="0"
          (click)="confirmPwdToggler.toggle()"
          (keydown.enter)="confirmPwdToggler.toggle()"
          (keydown.space)="confirmPwdToggler.toggle()"
          aria-label="Show or hide confirm password"
        >
          <svg width="15" viewBox="0 0 12 7" fill="currentColor">
            <use href="assets/sprite.svg#svg-deactivate-s-icon"></use>
          </svg>
        </div>
      </div>
      <p class="text-danger" *ngxControlError="form.controls.confirmNewPassword; track: 'required'">
        Confirm password is required.
      </p>
      @if (
        !form.controls.confirmNewPassword.errors?.['required'] && form.errors?.['passwordError']
      ) {
        <!-- <p class="text-danger">
            The new password and confirmation password do not match. Please try again
          </p> -->
        <p class="text-danger">Passwords don’t match. Try again.</p>
      }
      <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="right">
          <ul class="password-strength">
            @if (passwordStrength() === 'strong') {
              <li class="strong"></li>
              <li class="strong"></li>
              <li class="strong"></li>
            } @else if (passwordStrength() === 'medium') {
              <li class="medium"></li>
              <li class="medium"></li>
              <li></li>
            } @else {
              <li [class.weak]="passwordStrength() === 'weak'"></li>
              <li [class.strong]="passwordStrength() === 'strong'"></li>
              <li [class.medium]="passwordStrength() === 'medium'"></li>
            }
          </ul>
        </div>
        <div class="left">
          <p [class.strong]="passwordStrength() === 'strong'">{{ passwordStrengthText() }}</p>
        </div>
      </div>
    </div>
    <ul class="password-requirements">
      <app-password-validation-item
        [control]="form.controls.newPassword"
        errorKey="newLength"
        message="At least 8 characters"
      />

      <app-password-validation-item
        [control]="form.controls.newPassword"
        errorKey="newUpperCase"
        message="At least one uppercase letter"
      />

      <app-password-validation-item
        [control]="form.controls.newPassword"
        errorKey="newLowerCase"
        message="At least one lowercase letter"
      />
      <app-password-validation-item
        [control]="form.controls.newPassword"
        errorKey="newNumber"
        message="At least one number"
      />

      <app-password-validation-item
        [control]="form.controls.newPassword"
        errorKey="newSpecialChar"
        message="special characters (!@#$%^&*)"
      />
    </ul>

    <!-- <button class="btn theme-btn w-100" type="submit">Change password</button> -->
    <button class="btn btn-warning w-100" type="submit">Change password</button>
    <div class="text-center">
      <h6 class="mt-3 fw-semibold">
        Customer Support
        <svg class="ms-1" width="14" viewBox="0 0 13 13" fill="currentColor">
          <use [attr.href]="'assets/sprite.svg#svg-info'"></use>
        </svg>
      </h6>
    </div>
  </form>
} @else {
  <div class="text-center">
    <h2 class="mb-3">Your invitation link has expired</h2>
    <p class="mb-2">
      This invitation link is no longer valid. For security reasons, invitations must be used within
      24h of being sent
    </p>

    <div class="text-center">
      <h6 class="mt-3 fw-semibold">
        Customer Support
        <svg class="ms-1" width="14" viewBox="0 0 13 13" fill="currentColor">
          <use [attr.href]="'assets/sprite.svg#svg-info'"></use>
        </svg>
      </h6>
    </div>
  </div>
}
