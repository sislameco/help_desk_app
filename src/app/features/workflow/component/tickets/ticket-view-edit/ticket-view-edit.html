@if (ticket) {
  <div class="ticket-update container-fluid py-3">
    <!-- ðŸ”¹ Header -->
    <div class="d-flex border-bottom pb-2 mb-3">
      <div class="d-flex align-items-end gap-2">
        <h4 class="fw-bold">
          {{ ticketBasicInfo().ticketNumber }}
          <!-- <span class="badge bg-secondary ms-2">{{ ticketBasicInfo().status }}</span> -->
        </h4>
        <small>{{ ticketBasicInfo().subject }}</small>
      </div>
    </div>

    <!-- ðŸ”¸ Two-Column Layout -->
    <div class="row g-4">
      <!-- ðŸ§© Left Panel -->
      <div class="col-lg-8 col-md-7">
        <!-- Summary -->
        <div class="mb-3 d-none">
          <p class="form-label fw-semibold">Summary</p>
          <!-- <input type="text" class="form-control" [(ngModel)]="ticket.subject" /> -->
        </div>

        <!-- Description -->
        <!-- <accordion [isAnimated]="true">
          <accordion-group>
            <button class="btn" accordion-heading type="button">
              <div class="heading-title">Personal Information</div>
              <span class="icon">
                <svg width="7" viewBox="0 0 7 4" fill="currentColor">
                  <use xlink:href="assets/sprite.svg#svg-angle-down-2"></use>
                </svg>
              </span>
            </button>
            <ul class="navbar-nav app-or-menu">
              <li>
                <div class="app-or-menu-item">Sub Items</div>
              </li>
              <li>
                <div class="app-or-menu-item">Sub Items</div>
              </li>
              <li>
                <div class="app-or-menu-item">Sub Items</div>
              </li>
            </ul>
          </accordion-group>
        </accordion> -->
        <div class="mb-4">
          <!-- <p class="form-label fw-semibold">Description</p> -->
          <button class="collapse-btn mb-2" type="button" (click)="toggleDescription()">
            <span class="icon me-2" [class.collapsed]="isDescriptionCollapsed()">
              <svg width="9" viewBox="0 0 7 4" fill="currentColor">
                <use xlink:href="assets/sprite.svg#svg-angle-down-2"></use>
              </svg>
            </span>
            <span class="collapse-title">Description</span>
          </button>
          <div class="ngx-editor-container" [class.d-none]="isDescriptionCollapsed()">
            <ngx-editor-menu [editor]="editor"></ngx-editor-menu>
            <ngx-editor
              [(ngModel)]="ticketBasicInfo().description"
              [editor]="editor"
              [disabled]="false"
              [placeholder]="'Describe the issue in detail...'"
            ></ngx-editor>
          </div>
        </div>

        <!-- Attachments -->
        <app-ticket-attachment [attachments]="attachments()"></app-ticket-attachment>

        <!-- Comments -->
        <div class="mb-4">
          <h6 class="fw-bold text-primary mb-2">Comments</h6>
          <div *ngFor="let c of ticket.comments" class="border rounded p-2 mb-2">
            <strong>{{ c.user?.fullName }}</strong>
            <small class="text-muted float-end">{{ c.createdDate }}</small>
            <div class="mt-1">{{ c.text }}</div>
          </div>

          <div class="mt-3">
            <textarea rows="3" class="form-control mb-2" placeholder="Add a comment..."></textarea>
            <button class="btn btn-sm btn-primary" (click)="addComment()">
              <i class="bi bi-send"></i> Post Comment
            </button>
          </div>
        </div>
      </div>

      <!-- ðŸ§± Right Panel -->
      <div class="col-lg-4 col-md-5">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <!-- Status -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Status</p>
              <select class="form-select" [(ngModel)]="ticket.status">
                <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
              </select>
            </div>

            <!-- Priority -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Priority</p>
              <select class="form-select" [(ngModel)]="ticket.priority">
                <option *ngFor="let p of priorities" [value]="p.value">{{ p.label }}</option>
              </select>
            </div>

            <!-- Assignee -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Assignee</p>
              <ng-select
                [items]="users"
                bindLabel="fullName"
                bindValue="id"
                [(ngModel)]="ticket.assignedToUserId"
                placeholder="Select user"
              ></ng-select>
            </div>

            <!-- Departments -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Department(s)</p>
              <ng-select
                [items]="departments"
                bindLabel="name"
                bindValue="id"
                [multiple]="true"
                [(ngModel)]="ticket.departmentIds"
              ></ng-select>
            </div>

            <!-- Root Cause -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Root Cause</p>
              <ng-select
                [items]="rootCauses"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="ticket.rootCauseId"
                placeholder="Select root cause"
              ></ng-select>
            </div>

            <!-- Resolution -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Resolution</p>
              <ng-select
                [items]="resolutions"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="ticket.resolutionId"
                placeholder="Select resolution"
              ></ng-select>
            </div>

            <!-- Project -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Linked Project</p>
              <input
                class="form-control"
                [value]="ticket.project?.referenceNumber + ' - ' + ticket.project?.address"
                readonly
              />
            </div>

            <!-- SLA -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Due Date (SLA)</p>
              <input type="datetime-local" class="form-control" [(ngModel)]="ticket.dueDate" />
              <small class="text-muted" *ngIf="ticket.slaStatus">SLA: {{ ticket.slaStatus }}</small>
            </div>

            <!-- Watchers -->
            <div class="mb-3">
              <p class="form-label fw-semibold">Watchers</p>
              <ng-select
                [items]="users"
                bindLabel="fullName"
                bindValue="id"
                [multiple]="true"
                [(ngModel)]="ticket.watchers"
              ></ng-select>
            </div>

            <!-- Save Button -->
            <div class="text-end">
              <button class="btn btn-success w-100" (click)="updateTicket()">
                <i class="bi bi-save"></i> Update Ticket
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}
