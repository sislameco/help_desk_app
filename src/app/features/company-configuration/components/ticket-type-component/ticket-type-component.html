<div class="ticket-type-container">
  <h3 class="mb-3 fw-bold">ðŸŽ« Ticket Type Setup</h3>

  <!-- Loading Spinner -->
  <div *ngIf="loading()">Loading...</div>

  <!-- ========================== -->
  <!-- ðŸŽ¯ Create / Update Form -->
  <!-- ========================== -->
  <form [formGroup]="form" (ngSubmit)="save()" class="mb-4 card p-3 shadow-sm">
    <div class="row g-3">
      <!-- ðŸŸ© Title -->
      <div class="col-md-4">
        <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
        <input
          type="text"
          id="title"
          class="form-control"
          formControlName="title"
          placeholder="Enter title"
        />
        <strong class="text-danger" *ngxControlError="form.controls['title']; track: 'required'">
          Title is required.
        </strong>
      </div>

      <!-- ðŸŸ© Description -->
      <div class="col-md-4">
        <label for="description" class="form-label"
          >Description <span class="text-danger">*</span></label
        >
        <input
          type="text"
          id="description"
          class="form-control"
          formControlName="description"
          placeholder="Enter description"
        />
        <strong
          class="text-danger"
          *ngxControlError="form.controls['description']; track: 'required'"
        >
          Description is required.
        </strong>
      </div>

      <!-- ðŸŸ© Priority -->
      <div class="col-md-6">
        <label for="priorityLevel" class="form-label"
          >Priority Level <span class="text-danger">*</span></label
        >
        <select id="priorityLevel" class="form-select" formControlName="priority">
          <option value="" disabled selected>Select priority</option>
          <option *ngFor="let priority of priorities" [value]="priority.value">
            {{ priority.key }}
          </option>
        </select>
        <strong class="text-danger" *ngxControlError="form.controls['priority']; track: 'required'">
          Priority level is required.
        </strong>
      </div>

      <div class="form-group">
        <p>Default Assign User</p>
        <ng-select
          class="select-dropdown"
          [items]="users()"
          bindLabel="name"
          bindValue="id"
          [formControlName]="'fkAssignedUserId'"
          [searchable]="true"
          placeholder="Select user"
        >
          <ng-template ng-option-tmp let-item="item">
            <span>{{ item.name }}</span>
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group full">
        <p>Default Departments</p>
        <ng-select
          class="select-dropdown"
          [items]="departments()"
          [multiple]="true"
          bindLabel="name"
          bindValue="id"
          [formControlName]="'fkDepartmentIds'"
          [searchable]="true"
          placeholder="Select departments"
        >
          <ng-template ng-option-tmp let-item="item">
            <span>{{ item.name }}</span>
          </ng-template>
        </ng-select>
      </div>

      <div class="col-md-3 d-flex align-items-center mt-4">
        <div class="form-check">
          <input
            type="checkbox"
            id="enabled"
            formControlName="isEnabled"
            class="form-check-input"
          />
          <label for="enabled" class="form-check-label">Enabled</label>
        </div>
      </div>
    </div>

    <div class="mt-3 text-end">
      <button type="submit" class="btn btn-primary me-2">
        {{ isEditing() ? 'Update' : 'Create' }}
      </button>
      <button type="button" class="btn btn-secondary" *ngIf="isEditing()" (click)="cancelEdit()">
        Cancel
      </button>
    </div>
  </form>

  <!-- ========================== -->
  <!-- ðŸ“‹ Ticket Type Table -->
  <!-- ========================== -->
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Priority</th>
        <th>Default Assign User</th>
        <th>Default Assign Departments</th>
        <th>Enabled</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let t of ticketTypes()">
        <td>{{ t.title }}</td>
        <td>{{ t.description }}</td>
        <td>
          <span [class]="'badge bg-' + getPriorityColor(t.priority)">
            {{ t.priority | enumToString: enumPriority }}
          </span>
        </td>
        <td>{{ t.userName }}</td>
        <td>
          <span *ngFor="let d of t.departmentNames" class="badge bg-secondary me-1">
            {{ d }}
          </span>
        </td>
        <td>
          <span [class.text-success]="t.isEnabled" [class.text-danger]="!t.isEnabled">
            {{ t.isEnabled ? 'Active' : 'Disabled' }}
          </span>
        </td>
        <td>
          <button class="btn btn-sm btn-outline-primary me-1" (click)="edit(t)">Edit</button>
          <button class="btn btn-sm btn-outline-danger" (click)="delete(t.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
