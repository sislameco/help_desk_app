<div class="card shadow-sm p-3 mt-4">
  <h5>Root / Resolution Setup</h5>

  <!-- Type Selector -->
  <div class="d-flex align-items-center justify-content-between my-3">
    <div class="d-flex align-items-center">
      <label for="typeSelect" class="form-label me-2 mb-0">Select Type:</label>
      <!-- <select
        id="typeSelect"
        class="form-select d-inline-block w-auto"
        [(ngModel)]="selectedType"
        (change)="onTypeChange(selectedType)"
      >
        <option [value]="enumRootResolutionType.RootCause">Root Cause</option>
        <option [value]="enumRootResolutionType.Resolution">Resolution</option>
      </select> -->

      <ng-select
        class="select-dropdown select-dropdown-circle"
        id="typeSelect"
        [clearable]="false"
        [(ngModel)]="selectedType"
        (change)="onTypeChange(selectedType)"
        style="min-width: 150px"
      >
        <ng-option [value]="0">All</ng-option>
        <ng-option [value]="enumRootResolutionType.RootCause">Root Cause</ng-option>
        <ng-option [value]="enumRootResolutionType.Resolution">Resolution</ng-option>
      </ng-select>
    </div>

    <button type="button" class="ch-icon-btn" (click)="openModal(addEditTemplate, 'add')">
      <span class="icon">
        <svg width="11" viewBox="0 0 11 11" fill="currentColor">
          <use xlink:href="assets/sprite.svg#plus-icon"></use>
        </svg>
      </span>
      Add New
    </button>
  </div>

  <!-- Data Table -->
  <table class="app-table">
    <thead class="fixed-thead">
      <tr>
        <th style="width: 10%">#</th>
        <th style="width: 20%">Name</th>
        <th style="width: 35%">Description</th>
        <th style="width: 15%">Type</th>
        <th class="text-center" style="width: 20%">Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (item of rootResolutions(); track item.id; let i = $index) {
        <tr>
          <td>{{ i + 1 }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.description }}</td>
          <td>{{ item.type | enumToString: enumRootResolutionType }}</td>
          <td class="text-center">
            <div class="dropdown-action" dropdown placement="bottom left">
              <button dropdownToggle type="button" class="active-btn" id="dropDownButton_{{ i }}">
                <svg fill="currentColor" width="16" viewBox="0 0 18 18">
                  <use href="assets/sprite.svg#svg-cog"></use>
                </svg>
              </button>
              <ul *dropdownMenu class="dropdown-menu dropdown-menu-left">
                <li>
                  <button class="dropdown-item" (click)="openModal(addEditTemplate, 'view', item)">
                    <svg width="11" viewBox="0 0 11 10" fill="currentColor">
                      <use href="assets/sprite.svg#edit-s-icon"></use>
                    </svg>
                    View
                  </button>
                </li>
                <li>
                  <button class="dropdown-item" (click)="openModal(addEditTemplate, 'edit', item)">
                    <svg width="11" viewBox="0 0 11 10" fill="currentColor">
                      <use href="assets/sprite.svg#edit-s-icon"></use>
                    </svg>
                    Edit
                  </button>
                </li>
                <li>
                  <button class="dropdown-item" (click)="delete(item.id)">
                    <svg width="11" viewBox="0 0 11 10" fill="currentColor">
                      <use href="assets/sprite.svg#edit-s-icon"></use>
                    </svg>
                    Delete
                  </button>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>

  @if (!rootResolutions().length) {
    <p class="text-muted text-center mt-3">
      No records found for
      <strong>{{
        selectedType === enumRootResolutionType.RootCause ? 'Root Cause' : 'Resolution'
      }}</strong
      >.
    </p>
  }
</div>

<!-- Modal Template -->
<ng-template #addEditTemplate>
  <div class="app-modal">
    <div class="modal-header">
      <h5 class="modal-title">
        {{ isViewMode ? 'View Details' : formModel.id ? 'Edit Item' : 'Add New Item' }}
      </h5>
      <button class="close" (click)="modalRef?.hide()">
        <svg width="10" viewBox="0 0 10 10">
          <use href="assets/sprite.svg#svg-close"></use>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form class="app-form">
        <div class="form-group mb-3">
          <label for="name" class="input-label fw-bold">Name*</label>
          <input
            id="name"
            type="text"
            class="form-control"
            [(ngModel)]="formModel.name"
            name="name"
            [readonly]="isViewMode"
            required
          />
        </div>

        <div class="form-group mb-3">
          <label for="description" class="input-label fw-bold">Description*</label>
          <textarea
            id="description"
            class="form-control"
            rows="3"
            [(ngModel)]="formModel.description"
            name="description"
            [readonly]="isViewMode"
          ></textarea>
        </div>
      </form>
      @if (!isViewMode) {
        <div class="form-group text-nowrap text-center mt-4">
          <button type="button" class="ch-btn ch-btn-red-border" (click)="modalRef?.hide()">
            Cancel
          </button>
          <button type="submit" class="ch-btn ch-btn-green ms-3" (click)="save()">Save</button>
        </div>
      }
    </div>
  </div>
</ng-template>
